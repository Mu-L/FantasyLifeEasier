# Fantasy Life Easier

这里是Fantasy Life Easier，一个基于[AutoHotKey](https://www.autohotkey.com/)的键鼠宏脚本，用于自动化《幻想生活i》游戏中的一些重复性的操作。此脚本仅使用AutoHotKey中的键盘鼠标控制、延迟等待和窗口像素颜色检测功能，不涉及任何对游戏内存的读取和修改。

最初是因为买长披风换重置石太无聊，但是我的键鼠没有宏，又不想用闭源的键鼠宏软件，然后偶然间发现了AutoHotKey，写AutoHotKey脚本的过程中发现它的功能非常强大，可以实现很多有意思的功能。于是从一开始最简单的买长披风换重置石，慢慢加功能，直到最近实现了自动完成制作小游戏。写完之后觉得可以把它分享出来，让和我一样疲于重复点点点的玩家轻松一些，脚本代码完全开源，欢迎大家查看、使用和修改，祝大家早日毕业！

> 由于此脚本原本是为个人使用而编写，如果你的设置和我的不一样，可能需要自行修改脚本中的一些参数（如像素坐标、延迟时间等），修改之前建议先阅读下方的功能介绍和基本原理，并阅读[AutoHotKey v2.0 文档](https://www.autohotkey.com/docs/v2/index.htm)了解基本语法。

## 主要功能

- 基本
  - 一键使用单程/往返任意门
  - 一键保存/加载云存档
- 制作
  - 批量购买/选择长披风交换重置石
  - 自动识别并完成任意职业的制作小游戏
- 据点
  - 一键重新种植迷宫树
  - 一键重新SL并武器熟成
  - 一键加入/退出联机房间
- 无垠大陆
  - 自动击杀宝箱怪获取树枝
  - 自动刷新地区等级并检查传奇任务

## 使用前

1. 下载并安装[AutoHotKey](https://www.autohotkey.com/) **v2.0**版本（此脚本不兼容v1.x版本）。
1. 下载本脚本的源代码，双击运行`main.ahk`文件即可运行脚本。
1. 游戏建议选择“简体中文”显示，并在1920x1080分辨率下以窗口模式运行，同时需要保证游戏窗口没有被遮挡（如RTSS）。由于脚本中大量使用了像素颜色检测功能，如果你的设置不同，可能需要手动修改脚本中的全部像素坐标才能保证正常工作。

> 可以使用任何文本编辑器查看或修改脚本代码，这里推荐使用[VS Code](https://code.visualstudio.com/)，配合[AHK++](https://marketplace.visualstudio.com/items?itemName=mark-wiemer.vscode-autohotkey-plus-plus)插件，可以获得非常实用的语法高亮和代码提示。

## 使用方法

运行脚本`main.ahk`后会打开一个窗口，窗口为固定尺寸，窗口中有4个标签页：基本、制作、据点和无垠大陆，窗口底部有一个状态栏显示脚本的运行状态。脚本内的所有配置都会在正常关闭窗口时自动保存到配置文件`main.ini`中，脚本下次运行时会自动加载这些配置。

> 预设的配置已经在低级别的存档上测试通过，理论上更高级的也可以直接使用，只是效率可能偏低。在不确定配置是否合适的情况下，可以先用预设配置进行测试，如果发现不可用再修改配置。

任何时间按下`F3`可以暂停或恢复脚本的运行，按下`F4`可以退出脚本。如果使用中误触了某个操作可以立即按下`F3`或`F4`，避免脚本继续执行下去。脚本当前状态可以通过任务栏图标判断，如果是绿色的H，则代表正在运行，如果是两条绿色的竖线（去掉横的H），则代表脚本已暂停。

### 基本

#### 游戏窗口

“检查进程”按钮可以检测游戏窗口的状态信息，包括PID、窗口位置和大小等。脚本会定时检查游戏窗口的状态并显示在右方。如果位置显示为负数，大小为`0x0`，则代表游戏窗口已最小化，此时脚本无法正常工作。

“打开游戏窗口”按钮可以将游戏窗口打开，相当于把鼠标焦点切换到游戏窗口。脚本会在每次执行操作前自动打开游戏窗口，确保键鼠操作可以输入到游戏窗口内，如果需要手动打开，可以点击此按钮。

#### 脚本控制

“窗口位置”会显示脚本窗口当前的位置，如果同时选择了“记住窗口位置”，则脚本下次运行时会自动将窗口移动到上次关闭的位置。选择“脚本窗口置顶”可以将脚本窗口置顶，方便在游戏过程中查看脚本运行状态。

脚本内的按钮操作都有成功和失败两种结果，结果通过提示音反馈，成功提示音和失败提示音都可以在此处进行启用或禁用，选择启用时会播放一次提示音用于试听。

#### 传送门

“传送门位置”为传送门图标在你的菜单中的位置，在使用传送门功能之前需要先设置好，脚本在使用传送门功能时会按预设的位置选择传送门，并且检测对应位置的像素是否匹配传送门颜色，如果不匹配（位置选择错误或在战斗状态中），脚本会自动停止。

“单程”按钮可以一键使用一次传送门。

“往返”按钮可以一键连续使用两次传送门，方便刷新当前区域的怪物和资源。

#### 存档

“保存云”按钮可以一键保存云存档，脚本会自动点击菜单中的“保存”按钮并同时选择“同时保存至共享存档”，然后等待保存完成。

“加载云”按钮可以一键加载云存档，脚本会自动点击菜单中的“返回标题画面”按钮并同时选择“从共享存档读取”，然后等待加载完成。

### 制作

#### 长披风->重置石

此处为批量购买长披风并交换重置石的功能。在使用之前需要设置好数量和操作间隔，如果相邻两次操作间隔过短，可能会导致某些输入被游戏忽略。

“批量购买”流程：

1. 在游戏内和王都防具店对话，选择“购买”。
2. 光标移到长披风上。
3. 在脚本内设置数量和购买间隔。
4. 点击脚本内的“批量购买”按钮，脚本会自动点击购买按钮并等待购买完成。

“批量选择”流程：

1. 在游戏内和王都收藏家对话，选择“交换”。
2. 筛选显示披风并按获取顺序排列（保证长披风都在一起）。
3. 光标往上移动到**最下面**的长披风上。
4. 在脚本内设置数量和选择间隔。
5. 点击脚本内的“批量选择”按钮，脚本会自动选择指定数量长披风。
6. 手动确认已选择的长披风并点击交换。

#### 小游戏

此处为自动识别并完成任意职业的制作小游戏功能。由于每个人游戏进度不同，“连按”、“长按”和“转动”等特殊操作所需要的时间可能不同，因此可能需要调整脚本中的配置。

“单次操作”流程：

1. 开始任意制作小游戏。
1. 确保人物起始位置为**中间**的工作台，其他位置会导致无法正确识别。
1. 在脚本内点击“单次操作”按钮，脚本会自动识别并执行下一个操作。

> “单次操作”只适合用于测试合适的操作配置，不适合用于完成整个小游戏。

“连续操作”流程：

1. 开始任意制作小游戏。
1. 确保人物起始位置为**中间**的工作台，其他位置会导致无法正确识别。
1. 在脚本内点击“连续操作”按钮，脚本会自动识别并执行所有操作，直到完成全部小游戏。

> “连续操作”会循环执行，即使操作配置不合适也可以完成小游戏,但如果冗余的操作过多，可能无法保证每次都Excellent。例如：你的小游戏“连按”需要10次，而你在这里设置为8次，脚本会先执行8次连按，然后在下一个循环中会识别到当前操作仍然是“连按”，然后再执行8次连按，导致总共执行了16次连按。

### 据点

#### 扭蛋迷宫树

此处为一键重新种植迷宫树的功能。可以不断刷新迷宫树，直到找到自己需要的房间和Boss。

整体流程：

1. 在游戏内站到扭蛋迷宫树面前。
1. 在脚本内选择年代，由于每个人已经解锁的年代和想要的年代都不同，此处需要手动设置合适的移动方向和移动次数，确保脚本可以选到你想要的年代。
1. 点击脚本内的“重新种植”按钮，脚本会自动和扭蛋迷宫树对话，选择年代并种植新的迷宫树。
1. 通过路线图查看当前房间和Boss，判断是否需要重新种植。
1. 如果需要重新种植，点击脚本内的“下一次重新种植”按钮，脚本会退出路线图并重新种植迷宫树。
1. 循环上一步，直到找到自己需要的房间和Boss。

#### 武器熟成

此处为一键重新SL并查看武器熟成的功能。可以快速SL并查看武器熟成情况，避免手动SL和查看熟成。

整体流程：

1. 在游戏内站到武器熟成雕像面前。
1. 在脚本内点击“开始熟成”按钮，脚本会自动和武器熟成雕像对话并查看武器。
1. 查看武器熟成情况，判断是否需要SL熟成。
1. 如果需要SL熟成，点击脚本内的“下一次熟成”按钮，脚本会自动加载云存档并重新查看熟成。
1. 循环上一步，直到熟成到自己需要的属性。

#### 联机房间

此处为一键加入或退出联机房间的功能。可以非常方便地加入或退出联机房间，避免手动操作，可以用于交替拿取惊魂器。

整体流程：

1. 在游戏内站到联机柜台面前。
1. 在脚本内输入关键词和密码，关键词不可以留空，密码可以留空，表示为不需要密码。
1. 在脚本内点击“加入”按钮，脚本会自动和联机柜台对话并搜索房间关键词。
1. 在加载出房间列表后，脚本会自动暂停（相当于按下F3），此时可以将光标移动到想要加入的房间上，然后按下F3，脚本会继续执行并加入房间，如果提供了密码则会自动输入密码。
1. 脚本在检测到加入房间的蓝色天空后视为加入成功。
1. 加入后需要手动操作（拿取惊魂器或完成任务等），完成后可以点击脚本内的“退出”按钮，脚本会自动退出房间。
1. 如果需要重新加入房间，可以点击脚本内的“退出并重新加入”按钮，脚本会自动退出当前房间并重新搜索。

### 无垠大陆

#### 宝箱怪

此处为自动击杀宝箱怪获取树枝的功能。可以重复刷新击杀宝箱怪并获取树枝，避免手动重复操作。由于每个人的游戏进度和职业不同，所需要的蓄力时间也不同，因此可能需要调整脚本中的配置，以达到最佳效果。在调整之前首先需要了解脚本中预设的单次击杀流程：

1. 往返传送刷新宝箱怪。
1. 落地后同时按下w和e。
1. 等待`<蓄力时间>`。
1. 松开w和e施放技能。
1. 等待`<等待时间>`，用于完成击杀和等待技能后摇。
1. 按下`<复位前进时间>`的w拾取宝箱怪掉落的树枝。
1. 按下`<复位后退时间>`的s回到原地。
1. 等待`<手动复位时间>`用于手动复位（为重复击杀时的自动复位提供一定容错）。

> 如果你的战斗职业不能保证一次蓄力e可以击杀宝箱怪，那么仅靠调整此处的配置是不够的，需要修改脚本。

为了找到合适的时间配置和初始站位，首先需要站在宝箱怪的必经路径上，距离保持在仇恨范围之外的1~2个身位，然后按下脚本内的“测试技能”按钮，按以下顺序测试单次击杀流程是否可以：

1. 成功施放技能：如果无法施放技能，则增加`<蓄力时间>`。
1. 成功击杀宝箱怪：如果无法击杀宝箱怪，则需要调整站位，释放技能时宝箱怪在你背后则说明起始站位距离太近。
1. 拾取掉落的树枝：如果捡不到树枝则需要增加`<复位前进时间>`。
1. 回到原地：如果回不到原地则需要调整`<复位后退时间>`。

找到合适的时间配置和初始站位之后，可以尝试进行重复击杀，选择`<重复击杀数量>`后点击“刷新并击杀”按钮，脚本会自动重复往返传送并击杀宝箱怪，每次重复后会等待`<手动复位时间>`用于手动复位，防止多次击杀后站位出现偏差。

> 目前没有实现自动检测是否捡到树枝和是否回到原点的功能，因此在重复击杀时最好注意观察屏幕，防止树枝掉落后未能拾取，或者站位偏差过大。

#### 传奇任务

此处为自动刷新地区等级并检查传奇任务的功能。可以自动刷新当前地区的等级，并检查是否有传奇任务。

> 刷新等级在任何地区的塔都可以用，而检查任务仅在龙牙群岛地区的塔有效（原理为检测小地图边缘指定位置的颜色）。

整体流程：

1. 在游戏内传送到龙牙群岛地区的塔下，转身面向塔并出现放大镜图标。
1. 按下m键打开地图。
1. 如果地图上没有传奇任务，则在脚本内点击“刷新等级”按钮，脚本会自动关闭地图并刷新当前地区的等级，最后再次打开地图。如果选择了“刷新后自动检查”，脚本会在刷新等级后自动检查地图上是否有传奇任务刷出，如果刷出了脚本内打勾的任务类型，则会进行提示，否则视为没有任务。
1. 重复上述步骤，直到地图上有想要的传奇任务。

> 目前的检测完全基于像素颜色，脚本如果无法区别任务类型会提示冲突，此时需要手动检查地图上是否有想要的任务。已知冲突的任务有：翼尖峡谷和巨腹大平原西部。
